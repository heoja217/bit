<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- <sql> 태그 사용하기
=> 자주 사용되는 SQL문은 별도로 정의해두고 포함한다.
-->

<mapper namespace="carrot.dao.OrderDao">

  <!-- 객체의 컬럼과 프로퍼티를 연결한다. -->
  <resultMap type="Order" id="orderMap">
    <!-- PK 컬럼은 id 태그를 사용하여 지정한다. -->
    <id column="OCODE" property="no"/>
    <result column="SNO" property="supplierNo"/>
    <result column="CNO" property="clientNo"/>
    <result column="GNO" property="goodsNo"/>
    <result column="ODATE" property="orderDate"/>
    <result column="DDATE" property="deliveryDate"/>
    <result column="RDATE" property="endDate"/>
    <result column="OQTY" property="quantity"/>
    <result column="DEL_STAT" property="delState"/>
    <result column="OMEMO" property="note"/>
  </resultMap>

  
  <resultMap type="map" id="orderListMap">
    <!-- PK 컬럼은 id 태그를 사용하여 지정한다. -->
    <id column="OCODE" property="no"/>
    <result column="ODATE" property="orderDate"/>
    <result column="RDATE" property="endDate"/>
    <result column="OQTY" property="quantity"/>
    <result column="DEL_STAT" property="delState"/>
    <result column="OMEMO" property="note"/>
    
    <result column="SNO" property="supplierNo"/>
    
    <result column="CNO" property="clientNo"/>
    <result column="CCNAME" property="clientName"/>
    
   	<result column="GNO" property="goodsNo"/>
    <result column="GNAME" property="name"/>
    <result column="GUNIT" property="unit"/>
		<result column="GCAT" property="category"/>
  </resultMap>
  
  <sql id="orderSelect">
    SELECT PNO, PNAME, QTY, MKNO, MADE_DATE 
    FROM PRODUCTS
  </sql>
  
  <select id="selectList" parameterType="map" 
        resultMap="orderListMap">
    SELECT 
		  T1.OCODE, T1.SNO, T1.ODATE, T1.RDATE, T1.OQTY, T1.DEL_STAT, T1.OMEMO,  
		  T2.CNO, T2.CCNAME,
		  T3.GNO, T3.GNAME, T3.GUNIT, T3.GCAT
		FROM ORDERLIST T1 LEFT JOIN CLIENT T2 
		ON T1.CNO=T2.CNO LEFT JOIN GOODS T3 ON T1.GNO=T3.GNO
		WHERE T1.SNO=#{supplierNo}
		
		ORDER BY T1.OCODE		
	
    <if test="pageSize > 0">
      limit #{startIndex}, #{pageSize}
    </if>
  </select>
  
  <select id="selectOne" parameterType="int" resultMap="orderMap">
    <include refid="orderSelect"/> 
    WHERE OCODE=#{value}
  </select>
  
  <select id="totalSize" resultType="int">
    SELECT count(OCODE) FROM ORDERLIST
  </select>
  
  <insert id="insert" parameterType="Order"
    useGeneratedKeys="true" keyColumn="PNO" keyProperty="no">
    INSERT INTO 	(PNAME,QTY,MKNO,MADE_DATE) 
    VALUES (#{name},#{quantity},#{makerNo},#{madeDate})
  </insert>
  
  <update id="update" parameterType="Order">
    UPDATE PRODUCTS SET 
      PNAME=#{name},
      QTY=#{quantity},
      MKNO=#{makerNo},
      MADE_DATE=#{madeDate} 
    WHERE PNO=#{no}
  </update>
  
  <delete id="delete" parameterType="int">
    DELETE FROM PRODUCTS WHERE PNO=#{value}
  </delete>

</mapper>



















